<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Listado de Solicitudes</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .table-container {
            margin: 20px;
        }
        .nested-table {
            margin-left: 30px;
            margin-top: 10px;
        }
    </style>
</head>
<body class="bg-light">
    <div class="container mt-4">
        <h2>ðŸ“„ Solicitudes Registradas</h2>
        <table class="table table-bordered table-striped table-hover">
            <thead class="table-dark">
                <tr>
                    <th>NÂ° Solicitud</th>
                    <th>Empresa</th>
                    <th>Tipo Servicio</th>
                    <th>Solicitante</th>
                    <th>Fecha InspecciÃ³n</th>
                    <th>Hora</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
                {% for sol in solicitudes %}
                <tr>
                    <td>{{ sol.numero_solicitud }}</td>
                    <td>{{ sol.empresa }}</td>
                    <td>{{ sol.tipo_servicio }}</td>
                    <td>{{ sol.solicitante }}</td>
                    <td>{{ sol.fecha_inspeccion }}</td>
                    <td>{{ sol.hora_inspeccion }}</td>
                    <td>
                        <button class="btn btn-sm btn-primary" onclick="toggleDetails('{{ sol.id }}')">
                            Ver Detalles
                        </button>
                    </td>
                </tr>
                <tr id="details-{{ sol.id }}" style="display: none;">
                    <td colspan="7">
                        <h5>ðŸ”¬ Muestras</h5>
                        <table class="table table-sm table-bordered nested-table">
                            <thead class="table-secondary">
                                <tr>
                                    <th>Muestra/VÃ­as</th>
                                    <th>Matriz</th>
                                    <th>Producto Declarado</th>
                                    <th>Referencias</th>
                                    <th>AnÃ¡lisis</th>
                                    <th>AcreditaciÃ³n</th>
                                    <th>Cant. MÃ­nima</th>
                                    <th>Unidad</th>
                                    <th>Tiempo Reporte</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for m in sol.muestras %}
                                <tr>
                                    <td>{{ m.muestra_vias }}</td>
                                    <td>{{ m.matriz }}</td>
                                    <td>{{ m.producto_declarado }}</td>
                                    <td>{{ m.referencias }}</td>
                                    <td>{{ m.analisis }}</td>
                                    <td>{{ m.acreditacion }}</td>
                                    <td>{{ m.cantidad_minima }}</td>
                                    <td>{{ m.unidad }}</td>
                                    <td>{{ m.tiempo_reporte }}</td>
                                </tr>
                                {% if m.metodos %}
                                <tr>
                                    <td colspan="9">
                                        <b>âš™ MÃ©todos:</b>
                                        <ul>
                                            {% for met in m.metodos %}
                                            <li><b>{{ met.analisis }}</b>: {{ met.metodo }}</li>
                                            {% endfor %}
                                        </ul>
                                    </td>
                                </tr>
                                {% endif %}
                                {% endfor %}
                            </tbody>
                        </table>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <script>
        function toggleDetails(id) {
            const row = document.getElementById("details-" + id);
            row.style.display = (row.style.display === "none") ? "table-row" : "none";
        }
    </script>
</body>
</html>
